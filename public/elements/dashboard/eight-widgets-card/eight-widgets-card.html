<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../../bower_components/px-card/px-card.html">
<!-- six-up card element import -->
<link rel="import" href="../../../bower_components/px-widget-cards/px-fourup-horizontal.html">
<!-- simple chart element imports -->
<link rel="import" href="eight-widgets-card-styles.html">
<style>
.left_div {
    float: left;
    border-left: 1px solid #b1b1bc;
    border-bottom: 1px solid #b1b1bc;
    border-top: 1px solid #b1b1bc;
    height: 146px;
    width: 20%;
}

.dev_no {
    height: 50%;
    width: 100%;
}

.dev_status {
    margin: auto;
    font-size: 2rem;
    text-align: center;
    border: none;
    border-top: 1px solid #b1b1bc;
    height: 100%;
    width: 100%;
}

.dev_no p {
    text-align: center;
    padding: 0;
    font-size: larger;
    margin: auto;
    padding-top: 40px;
}

.op_st {
    height: 50%;
    width: 100%;
}

.right_div {
    width: 78%;
    float: left;
    margin: auto;
}

.dev_st {}

.float_row {
    float: left;
    padding: 4px;
    border-top: solid 1px #b1b1bc;
    border-left: solid 1px #b1b1bc;
    border-right: solid 1px #b1b1bc;
}

.bottom {
    border-bottom: solid 1px #b1b1bc;
}

.label {
    border: none;
    font-color: black;
}

.col1 {
    width: 30%;
    height: 20%;
    text-align: right;
    font-size: 15px;
}

.col2 {
    width: 40%;
    height: 20%;
    text-align: right;
    font-size: 15px;
}

.col3 {
    width: 20%;
    height: 20%;
    text-align: left;
    font-size: 15px;
}
</style>
<dom-module id="eight-widgets-card">
    <template>
        <px-card style="padding-bottom:0;padding-top:1.66666rem">
            <style include="eight-widgets-card-styles"></style>
            <px-fourup id="widgetsx4-1">
                <div class="widget-1" id="dev1_tag" on-click="detail1">
                    <div class="left_div">
                        <div class="dev_no">
                            <p>#1</p>
                        </div>
                        <div class="op_st">
                            <input type="text" id="dev1_st" class="dev_status" value="-">
                        </div>
                    </div>
                    <div class="right_div">
                        <div class="float_row">
                            <input class="label col1" type="text" value="운전시간" readOnly />
                            <input class="label col2" id="dev1_t1" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="Hr" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="전력" readOnly />
                            <input class="label col2" id="KW-401" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kW" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="흡입압력" readOnly />
                            <input class="label col2" id="dev1_t3" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kg/㎠" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="흡입온도" readOnly />
                            <input class="label col2" id="TIT-401" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="℃" readOnly />
                        </div>
                        <div class="float_row bottom">
                            <input class="label col1" type="text" value="토출압력" readOnly />
                            <input class="label col2" id="dev1_t5" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kg/㎠" readOnly />
                        </div>
                    </div>
                </div>
                <div class="widget-2" id="dev2_tag" on-click="detail2">
                    <div class="left_div">
                        <div class="dev_no">
                            <p>#2</p>
                        </div>
                        <div class="op_st">
                            <input type="text" class="dev_status" id="dev2_st" value="OFF" style="color:red;">
                        </div>
                    </div>
                    <div class="right_div">
                        <div class="float_row">
                            <input class="label col1" type="text" value="운전시간" readOnly />
                            <input class="label col2" id="dev2_t1" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="Hr" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="전력" readOnly />
                            <input class="label col2" id="dev2_t2" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kW" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="흡입압력" readOnly />
                            <input class="label col2" id="dev2_t3" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kg/㎠" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="흡입온도" readOnly />
                            <input class="label col2" id="dev2_t4" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="℃" readOnly />
                        </div>
                        <div class="float_row bottom">
                            <input class="label col1" type="text" value="토출압력" readOnly />
                            <input class="label col2" id="dev2_t5" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kg/㎠" readOnly />
                        </div>
                    </div>
                </div>
                <div class="widget-3" id="dev3_tag" on-click="detail3">
                    <div class="left_div">
                        <div class="dev_no">
                            <p>#3</p>
                        </div>
                        <div class="op_st">
                            <input type="text" id="dev3_st" class="dev_status" value="OFF" style="color:red;">
                        </div>
                    </div>
                    <div class="right_div">
                        <div class="float_row">
                            <input class="label col1" type="text" value="운전시간" readOnly />
                            <input class="label col2" id="dev3_t1" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="Hr" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="전력" readOnly />
                            <input class="label col2" id="dev3_t2" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kW" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="흡입압력" readOnly />
                            <input class="label col2" id="dev3_t3" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kg/㎠" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="흡입온도" readOnly />
                            <input class="label col2" id="dev3_t4" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="℃" readOnly />
                        </div>
                        <div class="float_row bottom">
                            <input class="label col1" type="text" value="토출압력" readOnly />
                            <input class="label col2" id="dev3_t5" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kg/㎠" readOnly />
                        </div>
                    </div>
                </div>
                <div class="widget-4" id="dev4_tag" on-click="detail4">
                    <div class="left_div">
                        <div class="dev_no">
                            <p>#4</p>
                        </div>
                        <div class="op_st">
                            <input type="text" id="dev4_st" class="dev_status" value="OFF" style="color:red;">
                        </div>
                    </div>
                    <div class="right_div">
                        <div class="float_row">
                            <input class="label col1" type="text" value="운전시간" readOnly />
                            <input class="label col2" id="dev4_t1" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="Hr" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="전력" readOnly />
                            <input class="label col2" id="dev4_t2" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kW" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="흡입압력" readOnly />
                            <input class="label col2" id="dev4_t3" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kg/㎠" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="흡입온도" readOnly />
                            <input class="label col2" id="dev4_t4" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="℃" readOnly />
                        </div>
                        <div class="float_row bottom">
                            <input class="label col1" type="text" value="토출압력" readOnly />
                            <input class="label col2" id="dev4_t5" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kg/㎠" readOnly />
                        </div>
                    </div>
                </div>
            </px-fourup>
            <px-fourup id="widgetsx4-2">
                <div class="widget-1" id="dev5_tag" on-click="detail5">
                    <div class="left_div">
                        <div class="dev_no">
                            <p>#5</p>
                        </div>
                        <div class="op_st">
                            <input type="text" id="dev5_st" class="dev_status" value="-">
                        </div>
                    </div>
                    <div class="right_div">
                        <div class="float_row">
                            <input class="label col1" type="text" value="운전시간" readOnly />
                            <input class="label col2" id="dev5_t1" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="Hr" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="전력" readOnly />
                            <input class="label col2" id="KW-402" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kW" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="흡입압력" readOnly />
                            <input class="label col2" id="dev5_t3" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kg/㎠" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="흡입온도" readOnly />
                            <input class="label col2" id="TIT-402" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="℃" readOnly />
                        </div>
                        <div class="float_row bottom">
                            <input class="label col1" type="text" value="토출압력" readOnly />
                            <input class="label col2" id="dev5_t5" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kg/㎠" readOnly />
                        </div>
                    </div>
                </div>
                <div class="widget-2" id="dev6_tag" on-click="detail6">
                    <div class="left_div">
                        <div class="dev_no">
                            <p>#6</p>
                        </div>
                        <div class="op_st">
                            <input type="text" id="dev6_st" class="dev_status" value="OFF" style="color:red;">
                        </div>
                    </div>
                    <div class="right_div">
                        <div class="float_row">
                            <input class="label col1" type="text" value="운전시간" readOnly />
                            <input class="label col2" id="dev6_t1" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="Hr" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="전력" readOnly />
                            <input class="label col2" id="dev6_t2" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kW" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="흡입압력" readOnly />
                            <input class="label col2" id="dev6_t3" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kg/㎠" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="흡입온도" readOnly />
                            <input class="label col2" id="dev6_t4" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="℃" readOnly />
                        </div>
                        <div class="float_row bottom">
                            <input class="label col1" type="text" value="토출압력" readOnly />
                            <input class="label col2" id="dev6_t5" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kg/㎠" readOnly />
                        </div>
                    </div>
                </div>
                <div class="widget-3" id="dev8_tag" on-click="detail8">
                    <div class="left_div">
                        <div class="dev_no">
                            <p>#8</p>
                        </div>
                        <div class="op_st">
                            <input type="text" id="dev8_st" class="dev_status" value="-">
                        </div>
                    </div>
                    <div class="right_div">
                        <div class="float_row">
                            <input class="label col1" type="text" value="운전시간" readOnly />
                            <input class="label col2" id="dev8_t1" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="Hr" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="전력" readOnly />
                            <input class="label col2" id="KW-403" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kW" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="흡입압력" readOnly />
                            <input class="label col2" id="dev8_t3" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kg/㎠" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="흡입온도" readOnly />
                            <input class="label col2" id="TIT-403" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="℃" readOnly />
                        </div>
                        <div class="float_row bottom">
                            <input class="label col1" type="text" value="토출압력" readOnly />
                            <input class="label col2" id="dev8_t5" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kg/㎠" readOnly />
                        </div>
                    </div>
                </div>
                <div class="widget-4" id="dev9_tag" on-click="detail9">
                    <div class="left_div">
                        <div class="dev_no">
                            <p>#9</p>
                        </div>
                        <div class="op_st">
                            <input type="text" id="dev9_st" class="dev_status" value="-">
                        </div>
                    </div>
                    <div class="right_div">
                        <div class="float_row">
                            <input class="label col1" type="text" value="운전시간" readOnly />
                            <input class="label col2" id="dev9_t1" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="Hr" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="전력" readOnly />
                            <input class="label col2" id="KW-404" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kW" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="흡입압력" readOnly />
                            <input class="label col2" id="dev9_t3" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kg/㎠" readOnly />
                        </div>
                        <div class="float_row">
                            <input class="label col1" type="text" value="흡입온도" readOnly />
                            <input class="label col2" id="TIT-404" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="℃" readOnly />
                        </div>
                        <div class="float_row bottom">
                            <input class="label col1" type="text" value="토출압력" readOnly />
                            <input class="label col2" id="dev9_t5" type="text" value="-" readOnly />
                            <input class="label col3" type="text" value="kg/㎠" readOnly />
                        </div>
                    </div>
                </div>
            </px-fourup>
            <iron-ajax id="todayBegin" url="/api/v1/datapoints" last-response="{{_deviceBeginData}}" method="POST" content-type="application/json" handle-as="json"> </iron-ajax>
            <iron-ajax id="deviceIronAjax" url="/api/v1/datapoints/latest" last-response="{{_deviceData}}" method="POST" content-type="application/json" handle-as="json"> </iron-ajax>
        </px-card>
    </template>
    <script>
    Polymer({
        is: 'eight-widgets-card',
        properties: {
            _response: {
                type: Array,
                computed: '_computeDeviceResponse(_deviceData)'
            },
            _beginResponse: {
                type: Array,
                computed: '_computeDeviceBeginResponse(_deviceBeginData)'
            },
            _prev_response: {
                type: Object
            },
            _beginData: {
                type: Object
            }
        },
        generateRequestBody: function() {
            var body = JSON.stringify({
                "tags": [{
                    "name": "KW-401"
                }, {
                    "name": "KW-402"
                }, {
                    "name": "KW-403"
                }, {
                    "name": "KW-404"
                }, {
                    "name": "TIT-401"
                }, {
                    "name": "TIT-402"
                }, {
                    "name": "TIT-403"
                }, {
                    "name": "TIT-404"
                }]
            });
            return body;
        },
        generateRequestBody2: function() {
            var todayMid = Date.parse(new Date().toDateString())
            var now = new Date();
            var body = JSON.stringify({
                "start": todayMid,
                "end": now.getTime(),
                "tags": [{
                    "name": "KW-401",
                    "limit": 1,
                    "order": "asc"
                }, {
                    "name": "KW-402",
                    "limit": 1,
                    "order": "asc"
                }, {
                    "name": "KW-403",
                    "limit": 1,
                    "order": "asc"
                }, {
                    "name": "KW-404",
                    "limit": 1,
                    "order": "asc"
                }]
            });
            console.log("body", body);
            return body;
        },
        _computeDeviceBeginResponse: function() {
            var t1_401 = document.getElementById("dev1_t1");
            var t1_402 = document.getElementById("dev5_t1");
            var t1_403 = document.getElementById("dev8_t1");
            var t1_404 = document.getElementById("dev9_t1");

            var dev1_st = document.getElementById("dev1_st");
            var dev5_st = document.getElementById("dev5_st");
            var dev8_st = document.getElementById("dev8_st");
            var dev9_st = document.getElementById("dev9_st");
            try {
                t1_401.value = parseInt((new Date().getTime() - this._deviceBeginData.tags[0].results[0].values[0][0]) / (1000 * 60 * 60));
            } catch (err) {
                dev1_st.value = "OFF";
                dev1_st.style.color = "red"
                console.log(err);
            }
            try {
                t1_402.value = parseInt((new Date().getTime() - this._deviceBeginData.tags[1].results[0].values[0][0]) / (1000 * 60 * 60));
            } catch (err) {
                dev5_st.value = "OFF";
                dev5_st.style.color = "red"
                console.log(err);
            }
            try {
                t1_403.value = parseInt((new Date().getTime() - this._deviceBeginData.tags[2].results[0].values[0][0]) / (1000 * 60 * 60));
            } catch (err) {
                dev8_st.value = "OFF";
                dev8_st.style.color = "red"
                console.log(err);
            }
            try {
                t1_404.value = parseInt((new Date().getTime() - this._deviceBeginData.tags[3].results[0].values[0][0]) / (1000 * 60 * 60));
            } catch (err) {
                dev9_st.value = "OFF";
                dev9_st.style.color = "red"
                console.log(err);
            }

        },
        _computeDeviceResponse: function() {
            var dev1_st = document.getElementById("dev1_st");
            var dev5_st = document.getElementById("dev5_st");
            var dev8_st = document.getElementById("dev8_st");
            var dev9_st = document.getElementById("dev9_st");
            data = this._deviceData.tags;
            console.log("data", data);
            var watt1 = document.getElementById("KW-401");
            var watt2 = document.getElementById("KW-402");
            var watt3 = document.getElementById("KW-403");
            var watt4 = document.getElementById("KW-404");
            var t4_401 = document.getElementById("TIT-401");
            var t4_402 = document.getElementById("TIT-402");
            var t4_403 = document.getElementById("TIT-403");
            var t4_404 = document.getElementById("TIT-404");
            if (data[0].results[0].values[0][1] != 0 && data[0].results[0].values[0][1] != null && (new Date().getTime() - data[0].results[0].values[0][0]) < 60000) {
                watt1.value = parseInt(data[0].results[0].values[0][1] / 1000);
                t4_401.value = data[4].results[0].values[0][1];
                dev1_st.value = "ON";
                dev1_st.style.color = "green"
            } else {
                watt1.value = "-";
                t4_401.value = "-";
                dev1_st.value = "OFF";
                dev1_st.style.color = "red"
            }
            if (data[1].results[0].values[0][1] != 0 && data[1].results[0].values[0][1] != null && (new Date().getTime() - data[0].results[0].values[0][0]) < 60000) {
                watt2.value = parseInt(data[1].results[0].values[0][1] / 1000);
                t4_402.value = data[5].results[0].values[0][1];
                dev5_st.value = "ON";
                dev5_st.style.color = "green"
            } else {
                watt2.value = "-";
                t4_402.value = "-";
                dev5_st.value = "OFF";
                dev5_st.style.color = "red"
            }
            if (data[2].results[0].values[0][1] != 0 && data[2].results[0].values[0][1] != null && (new Date().getTime() - data[0].results[0].values[0][0]) < 60000) {
                watt3.value = parseInt(data[2].results[0].values[0][1] / 1000);
                t4_403.value = data[6].results[0].values[0][1];
                dev8_st.value = "ON";
                dev8_st.style.color = "green"
            } else {
                watt3.value = "-";
                t4_403.value = "-";
                dev8_st.value = "OFF";
                dev8_st.style.color = "red"
            }
            if (data[3].results[0].values[0][1] != 0 && data[3].results[0].values[0][1] != null && (new Date().getTime() - data[0].results[0].values[0][0]) < 60000) {
                watt4.value = parseInt(data[3].results[0].values[0][1] / 1000);
                t4_404.value = data[7].results[0].values[0][1];
                dev8_st.value = "ON";
                dev8_st.style.color = "green"

            } else {
                watt4.value = "-";
                t4_404.value = "-";
                dev9_st.value = "OFF";
                dev9_st.style.color = "red"
            }

        },
        detail1: function(e, detail) {
            //console.log("clicked",this.updateDeck([{"dev_id":"1"}]));
            this.updateDeck([{
                "dev_id": "1",
                "tag" : "KW-401"
            }]);
        },
        detail2: function(e, detail) {
            this.updateDeck([{
                "dev_id": "2"
            }]);
        },
        detail3: function(e, detail) {
            this.updateDeck([{
                "dev_id": "3"
            }]);
        },
        detail4: function(e, detail) {
            this.updateDeck([{
                "dev_id": "4"
            }]);
        },
        detail5: function(e, detail) {
            this.updateDeck([{
                "dev_id": "5",
                "tag" : "KW-402"
            }]);
        },
        detail6: function(e, detail) {
            this.updateDeck([{
                "dev_id": "6"
            }]);
        },
        detail8: function(e, detail) {
            this.updateDeck([{
                "dev_id": "8",
                "tag" : "KW-403"
            }]);
        },
        detail9: function(e, detail) {
            this.updateDeck([{
                "dev_id": "9",
                "tag" : "KW-404"
            }]);
        },

        init: function() {

        },
        ready: function() {

            var _this = this;
            _this.$.todayBegin.body = _this.generateRequestBody2();
            _this.$.deviceIronAjax.body = _this.generateRequestBody();
            _this.$.todayBegin.generateRequest();
            _this.$.deviceIronAjax.generateRequest();

            setInterval(function() {
                _this.$.deviceIronAjax.generateRequest();
            }, 100000);
        },
        deckStateChanged: function(newState, oldState) {
            console.log("changed");
        },
        behaviors: [px.card]

    });
    </script>
</dom-module>
